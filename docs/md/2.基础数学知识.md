# 2.基础数学知识

图形学的大部分内容只是将数学公式直译成代码。数学公式越干净，写出的代码就越干净，所以本书的大部分内容都聚焦于“如何使用正确的数学公式完成工作”这个话题。本章回顾了高中和大学数学中的各种工具，旨在作为参考，而不是作为一个教程。本章可能看起来像是一个各种主题组成的大杂烩，事实上它也确实如此：每个主题之所以被选择是因为它在“标准”数学课程中的略微不寻常、因为它在图形学中具有核心地位、或者因为我们一般不从几何角处理它。除了对本书所使用的符号进行回顾外，本章还强调了标准本科课程中有时会跳过的几个要点，比如三角形的重心坐标。本章不会严肃探究这些知识，相反，我们会着重于直觉和几何解释。而对线性代数的讨论则被推迟到了第六章中我们学习矩阵变换之前。我们鼓励读者浏览本章以熟悉所涉及的主题，并在需要时参考本章。本章末尾的练习也许能帮助你确定哪些主题需要复习。

## <span data-type="text" style="color: var(--b3-font-color3);">2.1 集合和映射</span>

映射（mapping），也叫函数（function），是数学和编程的基础。像程序中的函数一样，数学中的映射接受某个类型（type）的参数，并将其映射到（返回）一个特定类型的对象。在程序中，我们说的是“类型”；在数学中，我们说的是“集合”。当一个对象是一个集合的成员时，我们使用 ∈ 符号。比如说，

$$
a\in S
$$

可以读作“ $a$ 是集合 $S$ 的成员”。给定任何两个集合 $A$ 和 $B $ ，我们可以通过取两个集合的笛卡尔积（cartesian product）来创建第三个集合，表示为 $A\times B$。这个集合 $A\times B$ 由所有可能的有序对 $(a,b)$ 组成，其中 $a\in B$ 且 $b\in B$。作为缩写，我们用符号 $A^2$表示 $A\times A$。我们可以扩展笛卡尔积，从三个集合中创建一个新集合，该集合包含所有可能的有序三元组，以此类推，从任意多的集合中创建任意长的有序元组。

常见的集合包括：

* $\mathbb{R}$——实数；
* $\mathbb{R^+}$——非负实数（包括0）；
* $\mathbb{R^2}$——真实二维平面中的有序对；
* $\mathbb{R^n}$——n维笛卡尔空间中的点；
* $\mathbb{Z}$——整数；
* $S^2$——单位球面上的三维点（R3 中的点）的集合。

请注意，虽然 $S^2$ 是由三维空间中的点组成的，但它也在一个可以用两个变量进行参数化的表面上，所以它可以被认为是一个二维集合。映射的记号使用箭头和冒号，例如：

$$
f:\mathbb{R}\mapsto \mathbb{Z},
$$

你可以把它理解为“有一个叫做 f 的函数，它将一个实数作为输入，并将其映射成一个整数”。这里，箭头前面的集合被称为函数的定义域（domain），右边的集合被称为目标（target）。

> 译注：此处的目标（target）指的是陪域（codomain）。关于这点的详细讨论请参考https://math.stackexchange. com/questions/440235/range-of-function-vs-target-of-function 中的回答。

计算机程序员可能更愿意使用下面的等价表达：“有一个叫 f 的函数，它有一个实数参数并返回一个整数”。换句话说，上面的集合映射符号等同于常见的编程符号：

$$
integer f(real) \leftarrow 等价 \rightarrow f:\mathbb{R} \mapsto \mathbb{Z}
$$

因此，“冒号-箭头”符号可以被认为是一种编程语法，就这么简单。

点 f(a) 被称为 a 的像（image），一个集合 A（定义域的子集）的像是目标的子集，目标包含 A 中所有点的像。整个定义域的像被称为函数的值域（range）。

### <span data-type="text" style="color: var(--b3-font-color3);">2.1.1 逆映射</span>

如果我们有一个函数 $f:A\mapsto B$，那么可能存在一个反函数（inverse function）$f^{-1}:B\mapsto A$，这是通过 $f^{-1}(b)=a,b=f(a)$ 定义的。该定义只在所有 $b \in B$是函数 $f$ 下一些点的像（也就是说，值域和目标相等）且只有一个这样的点（也就是说，在 $f(a)=b$ 中，只有一个让等式成立的 $a$）的情况下有效。这种映射或函数称为双射（bijection）。双射将每一个 $a\in A$ 映射到唯一的 $b\in B$ ，对于每一个 $b\in B$ ，正好有一个 $a\in A$ ，使 $f(a)=b$ 

​![image](assets/image-20241120191806-gx18wx2.png)​

**图 2.1**：一 个 双 射 $f$ 及其 反函数 $f^{-1}$。注 意，$f^{-1}$ 也 是 一个双 射。

例如，一组骑手和一组马匹之间的双射关系表明，每个人都骑着一匹马，每匹马都被骑着。这两个函数是骑手（马）和马（骑手），它们都是彼此的反函数。不是双射的函数没有反函数。

​![image](assets/image-20241120191916-qiyxti3.png)​

**图 2.2**：函 数 $g$ 不具有反函 数，因为集合 $d$ 中的两个元素映射到了集合 $E$ 中的同一个元素。函数 $h$ 没有反函数，因为集合 $d$ 中没有元素映射到集合 $F$ 中的元素 $T$。

一个双射的例子是$f:\mathbb{R}\mapsto\mathbb{R},f(x)=x^3$。它的反函数为$f^{-1}(x) =3\sqrt{x}$。这个例子表明，标准的符号可能有些笨拙，因为 $x$ 在 $f$ 和 $f^{-1}$ 中都被用作虚拟变量（dummy variable）。有时使用不同的虚拟变量会更直观，比如写成 $y = f(x)$ 和 $x = f^{-1}(y)$ 的形式。这就有了更直观的 $y=x^3$ 和 $x=\sqrt[3]{y}$。一个没有反函数的例子是 $sqr:\mathbb{R}\mapsto\mathbb{R}, sqr(x) = x^2$。它没有反函数的原因有两个：首先：$x^2 = (−x)^2$，其次定义域中没有成员映射到目标的负数部分。请注意，如果我们把定义域和值域限制在 $\mathbb{R}^+$，还是可以定义一个反函数的。如此一来 $\sqrt{x}$ 就是一个有效的反函数。

### <span data-type="text" style="color: var(--b3-font-color3);">2.1.2 区间</span>

通常情况下，我们希望让一个函数处理的实数局限在某个范围内，实现这种约束的一个 方法就是规定一个区间（interval）。区间的一个例子是“0 和 1 之间的实数、不包括 0 或 1”，我 们把它表示为 $(0,1)$。因为它不包括其端点，所以被称为开区间。相对应的闭区间则包含其端 点，用方括号表示：$[0,1]$。这种符号可以混合使用；比如，$[0,1)$ 包括 0，但不包括 1。当写一 个区间 $[a,b]$ 时，我们假定 $a≤b$。表示一个区间的三种常见方法如**图2.3**所示。区间的笛卡尔积经常被使用。例如，为了表示点$x$在三维的单位立方体中，我们说$x\in[0,1]^3$。

​![image](assets/image-20241120193716-5blhdaw.png)​

**图2.3**：三种等价的方式来表示 $a$ 到 $b$ 的左开右闭区间。

区间在与常常与集合运算结合在一起使用：交集（intersection）、并集（union）和差集 （difference）。例如，两个区间的交集是它们公共点的集合，符号 $\bigcap$ 用来表示交集。例如，$[3,5)\bigcap[4,6]=[4,5)$。而并集使用符号∪来表示两个区间中的点合并后产生的集合。例如，$[3,5)\bigcup[4,6]= [3, 6]$。差集运算符与前两个运算符不同，它根据参数顺序产生不同结果。减号用于差集运算， 它返回在左侧区间但不在右侧区间的点。例如，$[3,5)−[4,6]=[3,4]$，以及$[4,6]−[3,5]=[5,6]$。 这些操作用区间图就能很直观地表现出来。

​![image](assets/image-20241120194743-ir4dgup.png)​

**图 2.4**：在 $[3, 5)$ 和 $[4,6]$ 上的区 间 操 作。

### <span data-type="text" style="color: var(--b3-font-color3);">2.1.3 对数函数</span>

尽管今天对数（logarithm）已不像使用计算器之前那么普遍了，但它在具有指数项的方程 问题中仍然很有用。根据定义，每个对数都有一个基数 $a$（$base$ $a$，也称“底”）。$x$ 的以 $a$ 为底 的对数通常被写作 $\log_{a}{x}$，并且它被定义为若要得到 $x$ 需要将 $a$ 乘幂的指数值。即：

$$
y =\log_{a}{x} \Leftrightarrow a^y=x.
$$

请注意，以a为底数的对数函数和以a为底数的幂函数是互逆的。这个基本定义可引申出几 个结论：

$$
a^{\log_{a}(x)} = x;\\ \log_{a}{(a^x)} = x;\\ \log_{a}{(xy)} = \log_{a}{x} + \log_{a}{y};\\ \log_{a}{(x/y)} = \log_{a}{x} − \log_{a}{y};\\ \log_{a}{x} = \log_{a}{b}\log_{b}{x}.
$$

当我们将微积分应用于对数时，经常会出现特殊数字$e=2.718...$。以$e$为底的对数被称为自然对数（naturallogarithm）。我们一般用简写 $ln$ 来表示：

$$
\ln_{x} ≡ \log_{e}{x}.
$$

“≡”符号的意思是“根据定义恒等”。像 $π$ 一样，特殊数字 $e$ 在很多情况下都会出现。除了 $e$ 以 外，在许多领域还使用特定的基数进行操作，并在其写法中省略基数，即 $\log{x}$ 的形式。例如， 天文学家经常使用以 10 为底的对数，理论计算机科学家经常使用以 2 为底的对数。由于计算机图形学借鉴了许多其他领域的技术，我们将避免这种缩写。对数的导数和指数的导数阐明了为什么自然对数是“自然的”：

$$
\frac{d}{dx} \log_{a}{x} = \frac{1}{x\ln_{a}};\\
\frac{d}{dx} a^x = a^x\ln_{}{a}.
$$

上面的常数乘数只有在 $a=e$ 时才等于 1。

## <span data-type="text" style="color: var(--b3-font-color3);">2.2 求解二次方程</span>

一个二次方程（quadraticequation）满足如下格式：

$$
Ax^2+Bx+C=0,
$$

其中 $x$ 是一个未知的实数，而 $A、B$ 和 $C$ 是已知的常数。如果你能联想到 $y=Ax^2+Bx+C$ 的二维 $xy$ 图，那么该二次方程的解就是函数 $y$ 与 $x$ 轴交点的横坐标值。因为 $y=Ax^2+Bx+C$ 是一条抛物线，根据抛物线是否未相交、相切或相交于 $x$ 轴，将有零个、一个或两个实数解。

​![image](assets/image-20241120200651-uzifa6p.png)​

**图 2.5**：二次方程根的几何解释是抛物线与 $x$ 轴的 交点。

为了求解二次方程，我们先将方程除以 $A$：

$$
x^2 + \frac{B}{A} x + \frac{C}{A} =0.
$$

 然后，我们通过“构造平方项”的方式来合并项：

$$
(x+\frac{B}{2A})^2 − \frac{B^2}{4A^2} + \frac{C}{A} = 0.
$$

将常数部分移到等号右边，然后取平方根，得到：

$$
x + \frac{B}{2A} = \pm \sqrt{\frac{B^2}{4A^2} − \frac{C}{A}}.
$$

从两边减去 $\frac{B}{2A}$，然后用分母 $2A$ 合并分式，就得到了我们熟悉的形式：

$$
x = \frac{−B \pm \sqrt{B^2 − 4AC}} {2A}.
$$

此处的“$\pm$”符号意味着有两个解，一个是正号，一个是负号。因此，$3\pm1$ 等于 2 或 4。请注意，决定实数解数量的项是：

$$
D≡B^2−4AC,
$$

这被称为二次方程的判别式（discriminant）。如果 $D > 0$，有两个实数解（也叫根（root））；如果 $D=0$，有一个实数解（一个双根（a "double" root））；如果 $D<0$ 则没有实数解。

例如，$2x^2+6x+4=0$ 的根是 $x=−1$ 和 $x=−2$，方程 $x^2+x+1=0$ 没有实数解。这些方程的判别式分别是 $D=4$ 和 $D=−3$，且我们都按预期得到了解的数量。在程序中，我们通常先评估D值，如果D为负数，则直接返回无根（noroots）而不取平方根。

## <span data-type="text" style="color: var(--b3-font-color3);">2.3 三角函数</span>

‍
